{"version":3,"file":"block_main.min.js","sources":["../src/block_main.js"],"sourcesContent":["\n\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * block_actvtmodal/block_main\n *\n * @module     block_actvtmodal/block_main\n * @copyright  2025 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\n\nexport const init = async(blockid, contextid, courseid, userid, canedit) => {\n    let str = await import('core/str');\n    const bindEvents = (event, selector, func) => {\n        $(document).off(event, selector).on(event, selector, func);\n    };\n\n    bindEvents('change', '[name=config_modcm]', function() {\n        let configcm = [];\n        if ($(this).is(':checked')) {\n            configcm.push($(this).val());\n        } else {\n            configcm = configcm.filter(x => x != $(this).val());\n        }\n        $('[name=config_disablecm]').val(configcm.join(','));\n    });\n\n    const updateConfigType = async() => {\n        let $table = $('#configtypewrapper').find('table');\n        let $tr = $table.find('tbody tr');\n        // Unset the configtype value.\n        let configtype = {};\n        $tr.each(function(index, elem) {\n            let $this = $(elem);\n            configtype[$this.find('[name=disabletype]').val()] = {\n                'd': $this.find('[name=disabletype]').is(':checked'),\n                'o': $this.find('[name=overridetype]').is(':checked'),\n                'p': $this.find('[name=showpageheader]').is(':checked'),\n                't': $this.find('[name=showtitle]').is(':checked'),\n                'a': $this.find('[name=showactivityheader]').is(':checked'),\n                's': $this.find('[name=showsecondarynav]').is(':checked'),\n                'b': $this.find('[name=showblock]').is(':checked'),\n                'u': $this.find('[name=urlparams]').val(),\n            };\n        });\n        $('[name=config_disabletype]').val(JSON.stringify(configtype));\n    };\n\n    bindEvents('change', '#configtypewrapper [type=checkbox]', function() {\n        updateConfigType();\n    });\n\n    bindEvents('input', '#configtypewrapper [type=text]', function() {\n        updateConfigType();\n    });\n\n    if ($('body').hasClass('editing')) {\n        return;\n    }\n\n    let sitecss = $('#sitecss').val();\n    if (!sitecss || sitecss == 'null') {\n        sitecss = '';\n    }\n\n    let configjson = $('#configjson').val();\n    if (!configjson || configjson == 'null') {\n        configjson = '{}';\n    }\n    configjson = JSON.parse(configjson || '{}');\n    let showactivityheader = Object.keys(configjson).length === 0 ? true :\n        !configjson.showactivityheader || configjson.showactivityheader != 0;\n    let showtitle = configjson.showtitle == 1;\n    let showsecondarynav = configjson.showsecondarynav == 1;\n    let showblock = configjson.showblock == 1;\n    let showpageheader = configjson.showpageheader == 1;\n    let css = configjson.css || '';\n    let types = JSON.parse(configjson.disabletype || '{}');\n    let disabletypekeys = Object.keys(types);\n    let disabledtypes = [];\n    disabletypekeys.forEach(key => {\n        if (types[key] && types[key].d) {\n            disabledtypes.push(key);\n        }\n    });\n\n    let disablecm = configjson.disablecm ? configjson.disablecm.split(',') : [];\n\n    let active = false; // Modal active.\n    bindEvents('click.AM', '[id=\"courseindex\"] a.courseindex-link, .course-content a.aalink, nav#courseindex a[data-for=cm_name]',\n        async function(e) {\n            if (active) {\n                return;\n            }\n            active = true;\n            e.preventDefault();\n            let href = $(this).attr('href');\n            // Regex match mod/xxx/view.php?id=xxx\n            let matches = href.match(/mod\\/([^\\/]+)\\/view.php\\?id=(\\d+)/);\n            if (!matches) {\n                // Open the link.\n                window.location.href = href;\n                return;\n            }\n            let url = href;\n            let mod = matches[1];\n            let id = matches[2];\n            if (disablecm.includes(id)) {\n                return;\n            }\n            if (disabledtypes.includes(mod)) {\n                return;\n            }\n            let config = types[mod];\n\n            if (!config) {\n                config = {};\n            }\n            if (!config.o) {\n                config.showtitle = showtitle;\n                config.showactivityheader = showactivityheader;\n                config.showsecondarynav = showsecondarynav;\n                config.showblock = showblock;\n                config.showpageheader = showpageheader;\n            } else {\n                config.showtitle = config.t;\n                config.showactivityheader = config.a;\n                config.showsecondarynav = config.s;\n                config.showblock = config.b;\n                config.showpageheader = config.p;\n            }\n\n            if (config.u && config.u != '') {\n                if (config.u.startsWith('?')) {\n                    url += config.u;\n                } else {\n                    url += '&' + config.u;\n                }\n            }\n\n            let activityModal = await ModalFactory.create({\n                body: `<div class=\"position-absolute w-100 h-100 no-pointer bg-transparent\"\n                         id=\"background-loading\">\n                        <div class=\"d-flex h-100 align-items-center justify-content-center\">\n                            <div class=\"spinner-border text-danger\"\n                                 style=\"width: 3rem;\n                                        height: 3rem\"\n                                 role=\"status\">\n                                <span class=\"sr-only\">Loading...</span>\n                            </div>\n                        </div>\n                    </div>`,\n                large: true,\n                show: false,\n                removeOnClose: true,\n                isVerticallyCentered: true,\n            });\n\n\n            let root = activityModal.getRoot();\n            root.addClass('activitymodal');\n            root.find('.modal-dialog').addClass('modal-xl').removeClass('modal-lg');\n            let $body = root.find('.modal-body');\n            $body.addClass('overflow-hidden');\n            let data; // The current cm data.\n\n            let modalhidden = false;\n            root.find('[data-action=\"hide\"]').on('click', function() {\n                root.attr('data-region', 'modal-container');\n            });\n\n            root.off('click.modal').on('click.modal', function(e) {\n                if ($(e.target).closest('.modal-content').length === 0) {\n                    root.addClass('am-jelly-anim');\n                    setTimeout(() => {\n                        root.removeClass('am-jelly-anim');\n                    }, 500);\n                }\n            });\n            root.off(ModalEvents.hidden).on(ModalEvents.hidden, async function() {\n                activityModal.destroy();\n                $('body').removeClass('modal-open');\n                active = false;\n                modalhidden = true;\n                if (data && data.overallcompletion == -1) { // No completion, no care ;).\n                    return;\n                }\n\n                if (data && data.withavailability == 1) { // Referenced in availability, refresh the page.\n                    window.location.reload();\n                }\n\n                // Now get the new completion status.\n                let newcmdata = await Ajax.call([{\n                    methodname: 'block_actvtmodal_get_info',\n                    args: {\n                        courseid: courseid,\n                        cmid: id,\n                        userid: userid,\n                        completiononly: true,\n                    },\n                }])[0];\n\n                if (newcmdata.data) {\n                    let newdata = JSON.parse(newcmdata.data);\n                    if (newdata.overallcompletion != data.overallcompletion) {\n                        // We're going to update the course activity card.\n                        let card = await Ajax.call([{\n                            methodname: 'block_actvtmodal_get_cm_html',\n                            args: {\n                                data: JSON.stringify({\n                                    courseid: courseid,\n                                    cmid: id,\n                                    userid: userid,\n                                }),\n                            },\n                        }])[0];\n\n                        if (!card.data) {\n                            window.location.reload();\n                        }\n\n                        let html = JSON.parse(card.data).html;\n                        $(`li.activity[data-id=\"${id}\"]`).replaceWith(html).trigger('click');\n                    }\n                }\n            });\n\n            root.off(ModalEvents.shown);\n            root.on(ModalEvents.shown, async function() {\n                root.addClass('am-jelly-anim');\n                setTimeout(() => {\n                    root.removeClass('am-jelly-anim');\n                }, 500);\n                $('body').addClass('modal-open');\n                root.attr('data-region', 'popup'); // Must set to avoid dismissing the modal when clicking outside.\n                let cmdata = await Ajax.call([{\n                    methodname: 'block_actvtmodal_get_info',\n                    args: {\n                        courseid: courseid,\n                        cmid: id,\n                        userid: userid,\n                        completiononly: false,\n                    },\n                }])[0];\n\n                if (cmdata.data) {\n                    data = JSON.parse(cmdata.data);\n                } else {\n                    return;\n                }\n                root.find('.modal-title').empty()\n                    .addClass('w-100 d-flex align-items-center')\n                    .append(`\n                        <div id=\"am-ca-header-wrapper\"\n                         class=\"d-flex align-items-center w-100\">\n                            <div class=\"${data.activity.purpose} activityiconcontainer activity-icon am-mr-2 smaller small\">\n                                ${data.activity.icon}\n                                </div>\n                            <h5 class=\"h5 mb-0 clamp-1\">${data.activity.name}</h5>\n                        </div>\n                        ${canedit ? `<a href=\"${M.cfg.wwwroot}/course/mod.php?update=${id}\" class=\"btn border-0\" target=\"_blank\"\n                         title=\"${await str.get_string('edit', 'block_actvtmodal')}\">\n                            <i class=\"fa fa-pen\"></i>\n                        </a>` : ''}\n                        <a href=\"${url}\" class=\"btn border-0\" title=\"${await str.get_string('openpage', 'block_actvtmodal')}\">\n                            <i class=\"fa fa-external-link-alt\"></i>\n                        </a>\n                        <button type=\"button\" class=\"btn border-0 enterfullscreen\"\n                         title=\"${await str.get_string('expand', 'block_actvtmodal')}\">\n                            <i class=\"fa fa-expand\"></i>\n                        </button>\n                        <button type=\"button\" class=\"btn border-0 exitfullscreen\"\n                         title=\"${await str.get_string('narrow', 'block_actvtmodal')}\">\n                            <i class=\"fa fa-compress\"></i>\n                        </button>\n                        `);\n                $body.addClass('p-0');\n                $body.append(`<iframe src=\"${url}\" width=\"100%\" frameborder=\"0\" allowfullscreen class=\"d-none\"></iframe>`);\n                $body.removeClass('overflow-hidden');\n\n                // Run animation frame to get the iframe document.\n                let iframe = document.querySelector(`.activitymodal iframe`);\n                let divloaded = false;\n                let timeout = 0;\n                let timeoutInterval;\n                let clicklink;\n                let checkIframe = async() => {\n                    if (timeout > 15) {\n                        clearInterval(timeoutInterval);\n                        if (iframe) {\n                            iframe.classList.remove('d-none');\n                        }\n                        return;\n                    }\n                    if (iframe) {\n                        iframe.style.background = 'none';\n                        let contentWindow = iframe.contentWindow;\n                        if (!contentWindow) {\n                            requestAnimationFrame(checkIframe);\n                            return;\n                        }\n                        let contentDocument = iframe.contentDocument || iframe.contentWindow.document;\n                        let page = contentDocument.querySelector('div'); // Any div element.\n                        if (page) {\n                            divloaded = true;\n                            clearInterval(timeoutInterval);\n                            // If body does not have 'path-mod' class, it isn't a course page.\n                            if (!contentDocument.body.classList.contains('cmid-' + id)) {\n                                // Go to the link.\n                                activityModal.hide();\n                                window.location.href = clicklink;\n                                return;\n                            }\n                            iframe.classList.remove('d-none');\n                            // Add the am-embedactivity class to the body.\n                            contentDocument.body.classList.add('am-embedactivity');\n                            if (!config.showtitle) {\n                                contentDocument.body.classList.add('am-hidetitle');\n                            }\n                            if (!config.showactivityheader) {\n                                contentDocument.body.classList.add('am-hideactivityheader');\n                            }\n                            if (!config.showsecondarynav) {\n                                contentDocument.body.classList.add('am-hidesecondarynav');\n                            }\n                            if (!config.showblock) {\n                                contentDocument.body.classList.add('am-hideblock');\n                            }\n                            if (!config.showpageheader) {\n                                contentDocument.body.classList.add('am-hidepageheader');\n                            }\n\n                            if (sitecss != '') {\n                                contentDocument.head.innerHTML += '<style>' + sitecss + '</style>';\n                            }\n\n                            if (css != '') {\n                                contentDocument.head.innerHTML += '<style>' + css + '</style>';\n                            }\n\n                            // Append a div to the iframe.\n                            $(contentDocument.body).append(`<div id=\"am-embed-activity-container\">\n                                <a class=\"btn\" href=\"${url}\"\n                                 title=\"${await str.get_string('startpage', 'block_actvtmodal')}\">\n                                 <i class=\"fa fa-home\"></i></a>\n                                </div>`);\n\n                            contentWindow.addEventListener('unload', function() { // We have to reapply styles.\n                                iframe.classList.add('d-none');\n                                timeout = 0;\n                                requestAnimationFrame(checkIframe);\n                                timeoutInterval = setInterval(function() {\n                                    timeout += 1;\n                                    if (timeout > 15) {\n                                        clearInterval(timeoutInterval);\n                                        if (iframe) {\n                                            iframe.classList.remove('d-none');\n                                        }\n                                        return;\n                                    }\n                                    if (modalhidden) {\n                                        clearInterval(timeoutInterval);\n                                        timeout = 16;\n                                        return;\n                                    }\n                                }, 1000);\n                            });\n\n                            $(contentDocument).off('click.AM', 'a[href^=\"http\"]')\n                                .on('click.AM', 'a[href^=\"http\"]', function() {\n                                    clicklink = $(this).attr('href');\n                                });\n\n                        } else {\n                            requestAnimationFrame(checkIframe);\n                        }\n                    } else {\n                        requestAnimationFrame(checkIframe);\n                    }\n                };\n\n                requestAnimationFrame(checkIframe);\n                timeoutInterval = setInterval(function() {\n                    timeout += 1;\n                    if (timeout > 15) {\n                        clearInterval(timeoutInterval);\n                        if (iframe) {\n                            iframe.classList.remove('d-none');\n                        }\n                        return;\n                    }\n                }, 1000);\n\n                iframe.addEventListener('load', async function() {\n                    $body.find('#am-ca-back-wrapper').remove();\n                    // Load event waits until everything is loaded including the videos, images, etc., which isn't ideal.\n                    timeout = 0;\n                    if (!divloaded) { // Should not expect this to happen, but just in case.\n                        iframe.classList.add('d-none');\n                        requestAnimationFrame(checkIframe);\n                        return;\n                    }\n                    let iframedoc = iframe.contentDocument || iframe.contentWindow.document;\n                    if (!iframedoc || !iframedoc.body.classList.contains('course-' + courseid)) {\n                        iframe.classList.remove('d-none');\n                        iframe.classList.add('bg-white');\n                        $body.append(`<div id=\"am-ca-back-wrapper\" class=\"w-100 position-absolute top-0\">\n                                <a id=\"gobacktoactivity\" class=\"btn am-float-right\" href=\"javascript:void(0)\"\n                                 title=\"${await str.get_string('startpage', 'block_actvtmodal')}\">\n                                 <i class=\"fa fa-home fa-1x\"></i></a>\n                                </div>`);\n                        return;\n                    }\n\n                    iframe.classList.remove('bg-white');\n                });\n\n                $body.off('click', '#gobacktoactivity').on('click', '#gobacktoactivity', function(e) {\n                    e.preventDefault();\n                    $body\n                        .find('iframe')\n                        .replaceWith(`<iframe src=\"${url}\" width=\"100%\" frameborder=\"0\" allowfullscreen class=\"d-none\"></iframe>`);\n                    iframe = document.querySelector(`.activitymodal iframe`);\n                    divloaded = false;\n                    timeout = 0;\n                    requestAnimationFrame(checkIframe);\n                    clearInterval(timeoutInterval);\n                    timeoutInterval = setInterval(function() {\n                        timeout += 1;\n                        if (timeout > 15) {\n                            clearInterval(timeoutInterval);\n                            if (iframe) {\n                                iframe.classList.remove('d-none');\n                            }\n                            return;\n                        }\n                    }, 1000);\n                });\n            });\n\n            activityModal.show();\n\n        });\n\n    bindEvents('click.AM', '.activitymodal .exitfullscreen', function(e) {\n        e.preventDefault();\n        $(this).closest('.activitymodal').removeClass('fullscreen');\n    });\n\n    bindEvents('click.AM', '.activitymodal .enterfullscreen', function(e) {\n        e.preventDefault();\n        $(this).closest('.activitymodal').addClass('fullscreen');\n    });\n};\n"],"names":["async","blockid","contextid","courseid","userid","canedit","str","bindEvents","event","selector","func","document","off","on","configcm","this","is","push","val","filter","x","join","updateConfigType","$tr","find","configtype","each","index","elem","$this","JSON","stringify","hasClass","sitecss","configjson","parse","showactivityheader","Object","keys","length","showtitle","showsecondarynav","showblock","showpageheader","css","types","disabletype","disabletypekeys","disabledtypes","forEach","key","d","disablecm","split","active","e","preventDefault","href","attr","matches","match","window","location","url","mod","id","includes","config","o","t","a","s","b","p","u","startsWith","activityModal","ModalFactory","create","body","large","show","removeOnClose","isVerticallyCentered","root","getRoot","addClass","removeClass","data","$body","modalhidden","target","closest","setTimeout","ModalEvents","hidden","destroy","overallcompletion","withavailability","reload","newcmdata","Ajax","call","methodname","args","cmid","completiononly","card","html","replaceWith","trigger","shown","cmdata","empty","append","activity","purpose","icon","name","M","cfg","wwwroot","get_string","timeoutInterval","clicklink","iframe","querySelector","divloaded","timeout","checkIframe","clearInterval","classList","remove","style","background","contentWindow","requestAnimationFrame","contentDocument","contains","hide","add","head","innerHTML","addEventListener","setInterval","iframedoc"],"mappings":"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"}